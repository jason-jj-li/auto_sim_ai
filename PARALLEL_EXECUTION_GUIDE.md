# âš¡ å¹¶è¡Œæ‰§è¡ŒåŠŸèƒ½è¯´æ˜

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

æœ¬ç³»ç»Ÿç°å·²æ”¯æŒ**å¹¶è¡Œè¯·æ±‚æ‰§è¡Œ**ï¼Œå¯å°†æ¨¡æ‹Ÿé€Ÿåº¦æå‡ **5-30 å€**ï¼

### âœ… æ”¯æŒçš„ API ç±»å‹

| API ç±»å‹ | å¹¶è¡Œæ”¯æŒ | é€Ÿåº¦æå‡ | æˆæœ¬ |
|---------|---------|---------|------|
| **Local (LM Studio)** | âŒ ä¸æ”¯æŒ | 1x (åŸºå‡†) | å…è´¹ |
| **DeepSeek** | âœ… æ”¯æŒ | 5-20x | æä½ (~$0.0001/call) |
| **OpenAI** | âœ… æ”¯æŒ | 5-30x | ä¸­ç­‰ (~$0.001/call) |
| **Custom Cloud API** | âœ… æ”¯æŒ | 5-30x | å–å†³äºæä¾›å•† |

---

## ğŸš€ å¦‚ä½•ä½¿ç”¨

### **æ­¥éª¤ 1: åœ¨é¦–é¡µé…ç½® API**

1. æ‰“å¼€ `app.py` (é¦–é¡µ)
2. é€‰æ‹© API æä¾›å•†ï¼š
   - **DeepSeek** (æ¨è - ä¾¿å®œä¸”å¿«é€Ÿ)
   - **OpenAI** (æœ€å¼ºå¤§ä½†è¾ƒè´µ)
   - **Custom OpenAI-Compatible**

3. è¾“å…¥ API Key

4. **æŸ¥çœ‹å¹¶è¡Œè®¾ç½®åŒºåŸŸ** (è‡ªåŠ¨æ˜¾ç¤º):
   ```
   âš¡ Parallel Execution Settings
   
   [âœ“] Enable Parallel Requests
   
   Concurrent Workers: [5] â”â”â”â”â”â”â”â”â”â”â” (1-20)
   
   Estimated Speedup: ~5x faster
   
   Example: 100 personas Ã— 10 questions
   - Sequential: ~33 minutes
   - Parallel (5 workers): ~6 minutes
   ```

5. è°ƒæ•´ **Concurrent Workers** (å¹¶å‘æ•°):
   - **5-10**: å®‰å…¨ä¸”å¿«é€Ÿ âœ…
   - **10-15**: æ›´å¿«ï¼Œä½†å¯èƒ½é‡åˆ°é€Ÿç‡é™åˆ¶ âš ï¸
   - **15-20**: æœ€å¿«ï¼Œä½†éœ€è¦é«˜çº§ API è´¦æˆ· ğŸš¨

---

### **æ­¥éª¤ 2: è¿è¡Œæ¨¡æ‹Ÿ**

1. è¿›å…¥ **Simulation é¡µé¢**
2. é€‰æ‹©æ¨¡å¼ (Survey / Message Testing / A/B Testing)
3. é€‰æ‹© personas å’Œé—®é¢˜
4. ç‚¹å‡» **"Run Simulation"**

ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
- âœ… æ£€æµ‹æ˜¯å¦å¯ç”¨äº†å¹¶è¡Œæ¨¡å¼
- âœ… ä½¿ç”¨å¼‚æ­¥å¹¶å‘æ‰§è¡Œ (äº‘ API)
- âœ… æˆ–ä½¿ç”¨åºåˆ—æ‰§è¡Œ (æœ¬åœ° LM Studio)

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”ç¤ºä¾‹

### **åœºæ™¯: 100 ä¸ª personas Ã— 10 ä¸ªé—®é¢˜ = 1000 æ¬¡è°ƒç”¨**

| é…ç½® | æ‰§è¡Œæ—¶é—´ | åŠ é€Ÿæ¯” | æˆæœ¬ |
|------|---------|--------|------|
| **LM Studio (åºåˆ—)** | ~33 åˆ†é’Ÿ | 1x | $0 |
| **DeepSeek (5 å¹¶å‘)** | ~6 åˆ†é’Ÿ | 5.5x | ~$0.14 |
| **DeepSeek (10 å¹¶å‘)** | ~3 åˆ†é’Ÿ | 11x | ~$0.14 |
| **OpenAI GPT-3.5 (5 å¹¶å‘)** | ~6 åˆ†é’Ÿ | 5.5x | ~$1.50 |
| **OpenAI GPT-4 (5 å¹¶å‘)** | ~6 åˆ†é’Ÿ | 5.5x | ~$30 |

---

## âš™ï¸ æŠ€æœ¯å®ç°

### **æ¶æ„**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Streamlit UI (pages/2_Simulation.py)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                            â”‚
    â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SimulationEngine â”‚    â”‚ ParallelSimulationEngine â”‚
â”‚   (Sequential)   â”‚    â”‚     (Async/Parallel)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                        â”‚
          â–¼                        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ LMStudioClient â”‚      â”‚ AsyncLLMClient â”‚
    â”‚   (Sync)   â”‚          â”‚   (Async)      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **å…³é”®ä»£ç **

#### **1. å¼‚æ­¥ LLM å®¢æˆ·ç«¯** (`src/llm_client.py`)

```python
class AsyncLLMClient:
    async def generate_response_async(self, prompt: str, ...) -> str:
        """å¼‚æ­¥ç”Ÿæˆå“åº”ï¼Œæ”¯æŒå¹¶å‘"""
        async with aiohttp.ClientSession() as session:
            async with session.post(url, json=payload) as response:
                data = await response.json()
                return data['choices'][0]['message']['content']
```

#### **2. å¹¶è¡Œæ¨¡æ‹Ÿå¼•æ“** (`src/simulation.py`)

```python
class ParallelSimulationEngine:
    async def run_survey_parallel(self, personas, questions, ...):
        """å¹¶è¡Œæ‰§è¡Œæ‰€æœ‰ persona-question ç»„åˆ"""
        semaphore = Semaphore(self.max_workers)  # é™æµ
        
        async def process_single_query(persona, question):
            async with semaphore:
                return await self.async_client.generate_response_async(...)
        
        tasks = [process_single_query(p, q) for p in personas for q in questions]
        results = await asyncio.gather(*tasks)  # å¹¶è¡Œæ‰§è¡Œ
```

#### **3. UI é›†æˆ** (`pages/2_Simulation.py`)

```python
if use_parallel:
    import asyncio
    import nest_asyncio
    nest_asyncio.apply()  # å…è®¸åµŒå¥—äº‹ä»¶å¾ªç¯
    
    parallel_engine = ParallelSimulationEngine(llm_client, max_workers=5)
    result = asyncio.run(parallel_engine.run_survey_parallel(...))
else:
    engine = SimulationEngine(llm_client)
    result = engine.run_survey(...)  # åºåˆ—æ‰§è¡Œ
```

---

## ğŸ›¡ï¸ é€Ÿç‡é™åˆ¶å¤„ç†

### **ä½¿ç”¨ Semaphore æ§åˆ¶å¹¶å‘**

```python
semaphore = Semaphore(max_workers)  # ä¾‹å¦‚ï¼š5

async def limited_request():
    async with semaphore:  # æœ€å¤šåŒæ—¶ 5 ä¸ªè¯·æ±‚
        await make_api_call()
```

### **API æä¾›å•†é™åˆ¶**

| æä¾›å•† | é»˜è®¤é™åˆ¶ | æ¨èå¹¶å‘æ•° |
|--------|---------|-----------|
| DeepSeek Free | 50 requests/min | 5-10 |
| DeepSeek Paid | 500 requests/min | 10-20 |
| OpenAI Tier 1 | 3 requests/min | 2-3 |
| OpenAI Tier 3 | 3500 requests/min | 10-20 |

---

## ğŸ“ ä½¿ç”¨å»ºè®®

### **ä½•æ—¶ä½¿ç”¨å¹¶è¡Œï¼Ÿ**

âœ… **é€‚åˆåœºæ™¯:**
- å¤§è§„æ¨¡è°ƒç ” (50+ personas)
- ä½¿ç”¨äº‘ API (DeepSeek/OpenAI)
- æ—¶é—´æ•æ„Ÿçš„é¡¹ç›®

âŒ **ä¸é€‚åˆåœºæ™¯:**
- æœ¬åœ° LM Studio (ä¸ä¼šæ›´å¿«)
- å°è§„æ¨¡æµ‹è¯• (<10 queries)
- API è´¦æˆ·æœ‰ä¸¥æ ¼é€Ÿç‡é™åˆ¶

### **ä¼˜åŒ–å»ºè®®**

1. **ä»å°å¼€å§‹**: å…ˆç”¨ 5 ä¸ªå¹¶å‘æµ‹è¯•
2. **ç›‘æ§è¿›åº¦**: æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯
3. **é€æ­¥å¢åŠ **: å¦‚æœç¨³å®šï¼Œå¯å¢åŠ åˆ° 10-15
4. **è®¾ç½®é‡è¯•**: å¤„ç†å¶å‘çš„è¶…æ—¶é”™è¯¯

---

## ğŸ› æ•…éšœæ’æŸ¥

### **é—®é¢˜: å¹¶è¡Œé€‰é¡¹ä¸æ˜¾ç¤º**

**åŸå› **: é€‰æ‹©äº† Local (LM Studio)

**è§£å†³**: åˆ‡æ¢åˆ° DeepSeek æˆ– OpenAI

---

### **é—®é¢˜: é‡åˆ°é€Ÿç‡é™åˆ¶é”™è¯¯**

**ç—‡çŠ¶**:
```
Error 429: Too Many Requests
```

**è§£å†³**:
1. é™ä½ Concurrent Workers (ä¾‹å¦‚ä» 10 â†’ 5)
2. ç­‰å¾… 1 åˆ†é’Ÿåé‡è¯•
3. å‡çº§ API è´¦æˆ· tier

---

### **é—®é¢˜: éƒ¨åˆ†è¯·æ±‚å¤±è´¥**

**åŸå› **: ç½‘ç»œä¸ç¨³å®šæˆ–è¶…æ—¶

**è§£å†³**: ç³»ç»Ÿä¼šè‡ªåŠ¨è¿”å› `[Error: No response]`ï¼Œæ£€æŸ¥ç½‘ç»œè¿æ¥

---

## ğŸ“ˆ æ€§èƒ½ç›‘æ§

### **æŸ¥çœ‹å®æ—¶è¿›åº¦**

```
âš¡ Progress: 234/1000 (23.4%)
```

### **æŸ¥çœ‹å®Œæˆç»Ÿè®¡**

æ¨¡æ‹Ÿå®Œæˆåä¼šæ˜¾ç¤ºï¼š
- âœ… æˆåŠŸå“åº”æ•°
- âŒ å¤±è´¥å“åº”æ•°
- â±ï¸ æ€»è€—æ—¶
- ğŸ’° é¢„ä¼°æˆæœ¬

---

## ğŸ”’ å®‰å…¨æç¤º

1. **ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç  API Key**
2. **ä½¿ç”¨ç¯å¢ƒå˜é‡** (`.env` æ–‡ä»¶)
3. **å®šæœŸè½®æ¢ API Key**
4. **ç›‘æ§ API ä½¿ç”¨é‡**ï¼Œé¿å…æ„å¤–é«˜é¢è´¦å•

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. **ä¾èµ–å®‰è£…**: `pip install -r requirements.txt`
2. **å¿…éœ€åŒ…**: `aiohttp`, `nest-asyncio`
3. **Python ç‰ˆæœ¬**: >= 3.8

---

## ğŸ“œ æ›´æ–°æ—¥å¿—

### v1.0 (2025-10-25)
- âœ… æ·»åŠ å¼‚æ­¥ LLM å®¢æˆ·ç«¯
- âœ… å®ç°å¹¶è¡Œæ¨¡æ‹Ÿå¼•æ“
- âœ… UI è‡ªåŠ¨æ£€æµ‹å¹¶æ˜¾ç¤ºå¹¶è¡Œé€‰é¡¹
- âœ… æ”¯æŒ Survey å’Œ Message Testing æ¨¡å¼
- âœ… æ·»åŠ å¹¶å‘æ•°æ§åˆ¶å’Œè¿›åº¦åé¦ˆ

---

**ğŸ‰ äº«å— 5-30 å€çš„é€Ÿåº¦æå‡ï¼**
